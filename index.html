<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Instagram Username Checker — Sandbox‑Safe</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' x2='1'%3E%3Cstop stop-color='%238b5cf6'/%3E%3Cstop offset='1' stop-color='%236ee7b7'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='64' height='64' rx='12' fill='url(%23g)'/%3E%3Ctext x='50%25' y='58%25' text-anchor='middle' font-size='34' fill='white'%3Ei%3C/text%3E%3C/svg%3E">
  <style>
    :root{
      --bg:#0b0f14; --fg:#eaf0f7; --muted:#9fb0c3; --card:#0f1622; --accent:#8b5cf6; --ok:#22c55e; --bad:#ef4444;
      --border:rgba(255,255,255,.12); --glass:rgba(15,22,34,.8);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; color:var(--fg);
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(139,92,246,.25), transparent),
        radial-gradient(1000px 700px at 110% 10%, rgba(34,197,94,.18), transparent),
        var(--bg);
    }
    .container{max-width:1120px; margin:0 auto; padding:24px}
    .row{display:grid; gap:16px}
    @media(min-width:900px){.row{grid-template-columns:1fr 1fr}}
    .card{background:var(--glass); border:1px solid var(--border); border-radius:16px; padding:16px; backdrop-filter: blur(6px); box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .btn{appearance:none; border:0; border-radius:12px; padding:10px 14px; font-weight:600; color:#fff; background:var(--accent); cursor:pointer}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .btn.ghost{background:transparent; border:1px solid var(--border); color:var(--fg)}
    .input, textarea{width:100%; background:#0d141c; border:1px solid var(--border); color:var(--fg); border-radius:12px; padding:12px; outline:none}
    .muted{color:var(--muted)}
    .header{display:flex; gap:12px; justify-content:space-between; align-items:flex-start; flex-wrap:wrap; margin-bottom:16px}
    .chip{padding:6px 10px; border:1px solid var(--border); border-radius:999px; color:var(--muted); font-size:13px}
    .results{display:grid; gap:12px}
    @media(min-width:720px){.results{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:1020px){.results{grid-template-columns:repeat(3,1fr)}}
    .pill{display:inline-block; padding:2px 8px; font-size:12px; border-radius:999px; border:1px solid var(--border)}
    .pill.ok{background:rgba(34,197,94,.12); color:#bcffe3; border-color:rgba(34,197,94,.35)}
    .pill.bad{background:rgba(239,68,68,.12); color:#ffd3d3; border-color:rgba(239,68,68,.35)}
    .row-inline{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .switch{position:relative; width:56px; height:30px; background:rgba(255,255,255,.12); border-radius:999px; border:1px solid var(--border); cursor:pointer}
    .switch.knob{position:absolute; inset:2px; background:#fff; width:26px; height:26px; border-radius:999px; transform:translateX(0); transition:transform .2s ease}
    .switch.on .knob{transform:translateX(26px)}
    .segment{display:inline-grid; grid-template-columns:1fr 1fr; gap:4px; padding:4px; border-radius:12px; background:rgba(255,255,255,.08); border:1px solid var(--border)}
    .segbtn{padding:6px 10px; border-radius:8px; border:0; background:transparent; color:var(--fg); cursor:pointer}
    .segbtn.active{background:var(--accent)}
    .tests{margin-top:16px; font-size:13px}
    .ok{color:#86efac}
    .fail{color:#fca5a5}
    .avatar{width:48px; height:48px; border-radius:999px; border:1px solid var(--border); object-fit:cover}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 style="margin:0; font-size:26px">Instagram Username Checker</h1>
        <div class="muted" id="subtitle">Kullanıcı adları boşta mı dolu mu? Doluysa profil kartını gösterir.</div>
      </div>
      <div class="row-inline">
        <div class="segment" role="group" aria-label="language">
          <button class="segbtn active" data-lang="tr">TR</button>
          <button class="segbtn" data-lang="en">EN</button>
        </div>
        <div id="themeSwitch" class="switch on" role="switch" aria-checked="true">
          <div class="knob"></div>
        </div>
        <span class="chip">Sandbox‑safe</span>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <label><b id="lblUsernames">Kullanıcı adları</b></label>
          <textarea id="inputNames" rows="8" class="input" placeholder="mebularts\ninstagram\nbu_isim_bosta_olabilir"></textarea>
          <div class="row-inline" style="margin-top:10px">
            <button id="btnCheck" class="btn">Kontrol Et</button>
            <button id="btnSamples" class="btn ghost">Örnekleri Doldur</button>
            <label class="row-inline muted" style="margin-left:auto; gap:6px; font-size:14px">
              <input id="stopOnError" type="checkbox"/> Hata olursa dur
            </label>
            <span id="status" class="muted" style="font-size:14px"></span>
          </div>
        </div>
        <div>
          <label><b id="lblProxy">Proxy URL</b></label>
          <input id="proxy" class="input" placeholder="https://subdomain.workers.dev"/>
          <div id="proxyHint" class="muted" style="font-size:13px; margin-top:6px">Cloudflare Worker kök adresinizi girin. Örn: https://subdomain.workers.dev</div>
          <details style="margin-top:8px">
            <summary id="workerCodeTitle" class="muted" style="cursor:pointer">Cloudflare Worker Kodu</summary>
            <pre class="input" style="white-space:pre-wrap; overflow:auto; font-size:12px">export default {
  async fetch(req) {
    const u = new URL(req.url).searchParams.get('u');
    if (!u) return new Response('missing u', { status: 400 });
    const r = await fetch(u, { redirect: 'follow' });
    const h = new Headers(r.headers); h.set('access-control-allow-origin', '*');
    return new Response(await r.arrayBuffer(), { status: r.status, headers: h });
  }
}</pre>
          </details>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <div class="row-inline" style="justify-content:space-between">
        <div class="muted" id="lblResults">Sonuçlar</div>
        <div class="muted" id="lblCount"></div>
      </div>
      <div id="results" class="results" style="margin-top:12px"></div>
    </div>

    <div class="card" style="margin-top:16px">
      <div class="row-inline" style="justify-content:space-between; margin-bottom:10px">
        <div id="genTitle" style="font-weight:600">Varyasyon Üretici</div>
        <div class="muted" id="lblAmount">Adet</div>
      </div>
      <div class="row" style="grid-template-columns: 1fr 160px 1fr">
        <input id="base" class="input" placeholder="mebularts"/>
        <input id="amount" class="input" type="number" min="10" max="60" value="30"/>
        <div class="row-inline">
          <button id="btnGen" class="btn" style="flex:1">Üret</button>
          <button id="btnClear" class="btn ghost" style="flex:1">Temizle</button>
        </div>
      </div>
    </div>

    <div class="card tests" id="tests">
      <b>Tests</b>
      <ul id="testsList"></ul>
    </div>
  </div>

<script>
(function(){
  const t = {
    tr:{ title:'Instagram Username Checker', subtitle:'Kullanıcı adları boşta mı dolu mu? Doluysa profil kartını gösterir.', usernames:'Kullanıcı adları', check:'Kontrol Et', samples:'Örnekleri Doldur', results:'Sonuçlar', unknown:'Bilinmiyor', error:'Hata/Kısıt', useProxy:'Proxy kurup tekrar deneyin.', taken:'Kullanımda', available:'Boşta', availableMsg:'Bu kullanıcı adı kullanılabilir.', copy:'kopyala', signup:"Instagram'a kaydol", needOne:'Önce en az bir kullanıcı adı yazın.', proxyLbl:'Proxy URL', proxyHint:'Cloudflare Worker kök adresinizi girin. Örn: https://subdomain.workers.dev', worker:'Cloudflare Worker Kodu', genTitle:'Varyasyon Üretici', baseLbl:'Temel isim', genBtn:'Üret', clear:'Temizle', amount:'Adet', checking:'Kontrol ediliyor...', done:'Bitti' },
    en:{ title:'Instagram Username Checker', subtitle:'Are usernames free or taken? If taken, shows a profile card.', usernames:'Usernames', check:'Check', samples:'Fill samples', results:'Results', unknown:'Unknown', error:'Error/Constraint', useProxy:'Set up the proxy and try again.', taken:'Taken', available:'Available', availableMsg:'This username is available.', copy:'copy', signup:'Sign up', needOne:'Enter at least one username first.', proxyLbl:'Proxy URL', proxyHint:'Enter your Cloudflare Worker root. Eg: https://subdomain.workers.dev', worker:'Cloudflare Worker Code', genTitle:'Variation Generator', baseLbl:'Base name', genBtn:'Generate', clear:'Clear', amount:'Count', checking:'Checking...', done:'Done' }
  }
  let lang = 'tr';
  let dark = true;

  const el = s=>document.querySelector(s);
  const els = s=>Array.from(document.querySelectorAll(s));

  function setLang(l){ lang=l; const L=t[lang];
    el('#subtitle').textContent = L.subtitle;
    el('#lblUsernames').textContent = L.usernames;
    el('#btnCheck').textContent = L.check;
    el('#btnSamples').textContent = L.samples;
    el('#lblResults').textContent = L.results;
    el('#lblProxy').textContent = L.proxyLbl;
    el('#proxyHint').textContent = L.proxyHint;
    el('#workerCodeTitle').textContent = L.worker;
    el('#genTitle').textContent = L.genTitle;
    el('#lblAmount').textContent = L.amount;
    el('#btnGen').textContent = L.genBtn;
    el('#btnClear').textContent = L.clear;
    els('.segbtn').forEach(b=>b.classList.toggle('active', b.dataset.lang===l));
  }
  function setTheme(on){ dark=on; document.body.style.background = dark
      ? 'radial-gradient(1200px 800px at 10% -10%, rgba(139,92,246,.25), transparent), radial-gradient(1000px 700px at 110% 10%, rgba(34,197,94,.18), transparent), var(--bg)'
      : '#f7fafc';
    document.body.style.color = dark? 'var(--fg)':'#0b1220';
    el('#themeSwitch').classList.toggle('on', dark);
  }

  function normalize(u){
    return (u||'').toLowerCase().replace(/[^a-z0-9._]/g,'').slice(0,30);
  }
  function genVariations(base,n){
    base=(base||'').trim().toLowerCase(); if(!base) return [];
    const core=normalize(base.replace(/\s+/g,''));
    const pfx=['get','hey','try','real','the','go','iam','its','mr','ms','team','club'];
    const sfx=['app','dev','lab','labs','studio','hq','pro','official','co','tr','ai','io','net'];
    const seps=['','_','.'];
    const nums=['','1','01','10','24','25','123','x','xx'];
    const turk=['resmi','ofis','yazilim','ajans'];
    const leet=v=>v.replace(/a/g,'4').replace(/e/g,'3').replace(/i/g,'1').replace(/o/g,'0').replace(/s/g,'5');
    const vowelless=core.replace(/[aeiou]/g,'');
    const out=new Set([core,leet(core),vowelless]);
    for(const p of pfx){ for(const s of seps){ for(const n1 of nums){ out.add(normalize(p+s+core+n1)); } } }
    for(const sx of sfx){ for(const s of seps){ for(const n1 of nums){ out.add(normalize(core+s+sx+n1)); } } }
    for(const w of turk){ for(const s of seps){ out.add(normalize(core+s+w)); } }
    return Array.from(out).filter(Boolean).slice(0, Number(n)||30);
  }
  function decideAvailabilityFromHTML(status,text,u=''){
    const lower=(text||'').toLowerCase();
    const notFoundSigs=[
      'page not found',
      "sorry, this page isn't available",
      'üzgünüz, bu sayfaya ulaşılamıyor',
      'link you followed may be broken',
      'bağlantı bozuk olabilir',
    ];
    if(status===404 || notFoundSigs.some(sig=>lower.includes(sig))) return { exists:false };

    const existsSigs=[
      '/followers/', 'takipçi', 'following/', 'gönderi', 'profili düzenle',
      'aria-label="seçenekler"', 'role="img"', 'og:image', 'og:title', 'profile picture'
    ];
    if(existsSigs.some(sig=>lower.includes(sig))) return { exists:true };

    if(u){
      const uLower=(u||'').toLowerCase();
      if(lower.includes(`/${uLower}/followers/`)||lower.includes(`>${uLower}<`)||lower.includes(`content="https://www.instagram.com/${uLower}/"`)) return { exists:true };
    }

    return { exists:false };
  }

  function fetchViaProxy(proxy,url){
    return fetch(`${proxy}?u=${encodeURIComponent(url)}`, {redirect:'follow'})
      .then(r=>r.text().then(text=>({status:r.status, text})));
  }

  function checkOne(username, proxyRoot, live){
    const u = normalize(username);
    if(!u) return Promise.resolve({ username:u, error:'empty' });

    if(!live){
      const taken = ['instagram','zuck','cristiano','mebularts'];
      const exists = taken.includes(u);
      return Promise.resolve({
        username:u,
        exists,
        avatar: exists? 'https://i.pravatar.cc/96?u='+encodeURIComponent(u) : '',
        title: exists? (u+' • Mock User') : '',
        desc: exists? 'Mock bio for '+u : ''
      });
    }

    if(proxyRoot){
      return fetchViaProxy(proxyRoot, `https://www.instagram.com/api/v1/users/web_profile_info/?username=${u}`)
        .then(api=>{
          if(api.status===200 && api.text){
            try{
              const j = JSON.parse(api.text);
              if(j && j.data && j.data.user){
                const usr=j.data.user;
                const avatar=(usr.hd_profile_pic_url_info&&usr.hd_profile_pic_url_info.url)||usr.profile_pic_url||'';
                const title=(usr.full_name||'')+' | '+u;
                const desc=usr.biography||'';
                return { username:u, exists:true, avatar, title, desc };
              }
              if(j && j.data && j.data.user===null){
                return { username:u, exists:false, avatar:'', title:u, desc:'' };
              }
            }catch(e){}
          }
          return fetchViaProxy(proxyRoot, `https://www.instagram.com/${u}/?__a=1&__d=dis`).then(jr=>{
            if(jr.status===200 && jr.text.includes('profile_pic_url')){
              try{
                const data = JSON.parse(jr.text);
                const g = (data.graphql && data.graphql.user) || data.items || null;
                const user = Array.isArray(g)? g[0] : g;
                if(user){
                  const avatar = (user.profile_pic_url_hd||user.profile_pic_url)||'';
                  const title = (user.full_name||'')+' | '+u;
                  const desc = (user.biography||'');
                  return { username:u, exists:true, avatar, title:title||u, desc };
                }
              }catch(e){}
            }
            return fetchViaProxy(proxyRoot, `https://www.instagram.com/${u}/`).then(hr=>{
              const d = decideAvailabilityFromHTML(hr.status, hr.text, u);
              const ogImg = hr.text.match(/<meta[^>]+property=["']og:image["'][^>]+content=["']([^"']+)["'][^>]*>/i);
              const ogTitle = hr.text.match(/<meta[^>]+property=["']og:title["'][^>]+content=["']([^"']+)["'][^>]*>/i);
              const ogDesc = hr.text.match(/<meta[^>]+property=["']og:description["'][^>]+content=["']([^"']+)["'][^>]*>/i);
              const cdnImgMatch = hr.text.match(/<img[^>]+src=["']([^"']+cdninstagram[^"']+)["'][^>]*>/i);
              const avatar = ogImg? ogImg[1] : (cdnImgMatch? cdnImgMatch[1] : '');
              const title = ogTitle? ogTitle[1] : u;
              const desc = ogDesc? ogDesc[1] : '';
              return { username:u, exists:d.exists, avatar, title, desc };
            });
          });
        })
        .catch(()=>{
          return fetchViaProxy(proxyRoot, `https://www.instagram.com/${u}/`).then(hr=>{
            const d = decideAvailabilityFromHTML(hr.status, hr.text, u);
            const ogImg = hr.text.match(/<meta[^>]+property=["']og:image["'][^>]+content=["']([^"']+)["'][^>]*>/i);
            const ogTitle = hr.text.match(/<meta[^>]+property=["']og:title["'][^>]+content=["']([^"']+)["'][^>]*>/i);
            const ogDesc = hr.text.match(/<meta[^>]+property=["']og:description["'][^>]+content=["']([^"']+)["'][^>]*>/i);
            const cdnImgMatch = hr.text.match(/<img[^>]+src=["']([^"']+cdninstagram[^"']+)["'][^>]*>/i);
            const avatar = ogImg? ogImg[1] : (cdnImgMatch? cdnImgMatch[1] : '');
            const title = ogTitle? ogTitle[1] : u;
            const desc = ogDesc? ogDesc[1] : '';
            return { username:u, exists:d.exists, avatar, title, desc };
          });
        });
    }

    return fetch(`https://r.jina.ai/http://www.instagram.com/${u}/`)
      .then(fr=>fr.text().then(txt=>{
        const status = fr.status;
        const d = decideAvailabilityFromHTML(status, txt, u);
        const ogImg = txt.match(/<meta[^>]+property=["']og:image["'][^>]+content=["']([^"']+)["'][^>]*>/i);
        const ogTitle = txt.match(/<meta[^>]+property=["']og:title["'][^>]+content=["']([^"']+)["'][^>]*>/i);
        const ogDesc = txt.match(/<meta[^>]+property=["']og:description["'][^>]+content=["']([^"']+)["'][^>]*>/i);
        const cdnImgMatch = txt.match(/<img[^>]+src=["']([^"']+cdninstagram[^"']+)["'][^>]*>/i);
        const avatar = ogImg? ogImg[1] : (cdnImgMatch? cdnImgMatch[1] : '');
        const title = ogTitle? ogTitle[1] : u;
        const desc = ogDesc? ogDesc[1] : '';
        return { username:u, exists:d.exists, avatar, title, desc };
      }))
      .catch(e=>({ username:u, error:e.message }));
  }

  function safeCopy(text){
    return new Promise((resolve)=>{
      try{
        if(navigator.clipboard && navigator.clipboard.writeText){
          navigator.clipboard.writeText(text).then(()=>resolve(true)).catch(()=>fallback());
          return;
        }
      }catch(e){}
      fallback();
      function fallback(){
        try{
          const ta=document.createElement('textarea');
          ta.value=text; ta.setAttribute('readonly','');
          ta.style.position='fixed'; ta.style.left='-9999px';
          document.body.appendChild(ta); ta.select(); ta.setSelectionRange(0,ta.value.length);
          const ok=document.execCommand && document.execCommand('copy');
          document.body.removeChild(ta); resolve(!!ok);
        }catch(e){
          try{
            const temp=document.createElement('span'); temp.textContent=text;
            temp.style.position='fixed'; temp.style.left='-9999px'; document.body.appendChild(temp);
            const r=document.createRange(); r.selectNodeContents(temp);
            const s=window.getSelection(); s.removeAllRanges(); s.addRange(r);
            resolve(false);
          }catch(e2){ resolve(false); }
        }
      }
    });
  }

  function renderResults(items){
    const L=t[lang];
    el('#lblCount').textContent = items.length? String(items.length) : '';
    const root = el('#results'); root.innerHTML='';
    for(const r of items){
      const card = document.createElement('div'); card.className='card';
      if(r.error){
        card.innerHTML = `
          <div class="row-inline" style="justify-content:space-between">
            <div style="font-weight:700">@${r.username}</div>
            <span class="pill">${L.unknown}</span>
          </div>
          <div style="margin-top:6px; color:#ffd3d3">${L.error}: ${r.error}</div>
          <div class="muted" style="font-size:12px; margin-top:4px">${L.useProxy}</div>
        `;
      } else if(r.exists){
        card.innerHTML = `
          <div class="row-inline" style="gap:10px">
            <img class="avatar" referrerpolicy="no-referrer" src="${r.avatar||''}" onerror="this.style.visibility='hidden'" alt=""/>
            <div style="flex:1">
              <div class="row-inline" style="gap:8px; flex-wrap:wrap">
                <a href="https://www.instagram.com/${r.username}/" target="_blank" style="font-weight:700; color:inherit; text-decoration:underline">@${r.username}</a>
                <span class="pill bad">${L.taken}</span>
              </div>
              <div class="muted" style="font-size:14px; margin-top:4px">${(r.title||'').replace(/\| Instagram/g,'')}</div>
              <div class="muted" style="font-size:12px; margin-top:4px">${r.desc||''}</div>
            </div>
          </div>
        `;
      } else {
        card.innerHTML = `
          <div class="row-inline" style="justify-content:space-between">
            <div style="font-weight:700">@${r.username}</div>
            <span class="pill ok">${L.available}</span>
          </div>
          <div class="muted" style="margin-top:6px">${L.availableMsg}</div>
          <div class="row-inline" style="gap:8px; margin-top:8px; flex-wrap:wrap">
            <button class="btn ghost copy-btn" data-copy="@${r.username}">@${r.username} ${L.copy}</button>
            <a class="btn ghost" href="https://www.instagram.com/accounts/emailsignup/" target="_blank">${L.signup}</a>
          </div>
        `;
      }
      root.appendChild(card);
    }
  }

  function runCheck(){
    const L=t[lang];
    const names = el('#inputNames').value.split(/\r?\n/).map(s=>normalize(s.replace(/^@+/,''))).filter(Boolean);
    const list = Array.from(new Set(names)).slice(0,200);
    if(!list.length){ el('#status').textContent=L.needOne; return; }
    const proxyRoot = (el('#proxy').value||'').trim();
    const live = !!proxyRoot; // sandbox‑safe default: mock unless proxy provided
    el('#status').textContent=L.checking; renderResults([]);
    const out=[];

    (function process(i){
      if(i>=list.length){ el('#status').textContent=L.done; return; }
      checkOne(list[i], proxyRoot, live).then(item=>{
        out.push(item); renderResults(out);
        el('#status').textContent = `${i+1}/${list.length}`;
        if(item.error && el('#stopOnError').checked){ el('#status').textContent=L.done; return; }
        setTimeout(()=>process(i+1), 180);
      }).catch(e=>{
        out.push({ username:list[i], error:e.message }); renderResults(out);
        el('#status').textContent = `${i+1}/${list.length}`;
        if(el('#stopOnError').checked){ el('#status').textContent=L.done; return; }
        setTimeout(()=>process(i+1), 180);
      });
    })(0);
  }

  // UI bindings
  els('.segbtn').forEach(b=> b.addEventListener('click', ()=> setLang(b.dataset.lang)) );
  el('#themeSwitch').addEventListener('click', ()=> setTheme(!dark));
  el('#btnSamples').addEventListener('click', ()=>{
    el('#inputNames').value = lang==='tr' ? 'mebularts\ninstagram\nbu_isim_bosta_olabilir' : 'mebularts\ninstagram\nthis_may_be_free';
  });
  el('#btnCheck').addEventListener('click', runCheck);
  el('#btnGen').addEventListener('click', ()=>{
    const base = el('#base').value; const n = Number(el('#amount').value)||30;
    const vars = genVariations(base, n).join('\n');
    const cur = el('#inputNames').value.trim();
    el('#inputNames').value = cur ? (cur+'\n'+vars) : vars;
  });
  el('#btnClear').addEventListener('click', ()=>{ el('#inputNames').value=''; renderResults([]); el('#lblCount').textContent=''; });

  // Event delegation for copy buttons (clipboard‑safe)
  document.addEventListener('click', (ev)=>{
    const btn=ev.target.closest('.copy-btn'); if(!btn) return;
    const txt=btn.getAttribute('data-copy')||''; const label=btn.textContent;
    safeCopy(txt).then((ok)=>{
      btn.textContent = ok ? (lang==='tr'?'Kopyalandı':'Copied') : (lang==='tr'?'Kopya engellendi — Ctrl+C':'Copy blocked — Ctrl+C');
      setTimeout(()=>{ btn.textContent=label; }, 1400);
    });
  });

  // Defaults
  setLang('tr'); setTheme(true);

  // ---------- TESTS ----------
  function assert(name, cond){
    const li=document.createElement('li'); li.textContent=name+': '+(cond? 'OK' : 'FAIL'); li.className=cond? 'ok' : 'fail'; el('#testsList').appendChild(li);
  }
  (function runTests(){
    try{
      assert('normalize strips invalid', normalize('A!B?C')==='abc');
      assert('normalize keeps dot/underscore', normalize('a_b.c')==='a_b.c');
      const vars = genVariations('mebularts', 10);
      assert('variations length = 10', vars.length===10);
      assert('variations normalized', vars.every(v=>/^[-a-z0-9._]{1,30}$/.test(v)));
      const d1 = decideAvailabilityFromHTML(404, '');
      const d2 = decideAvailabilityFromHTML(200, "sorry, this page isn't available");
      const d3 = decideAvailabilityFromHTML(200, '<html><meta property="og:title" content="user"/></html>');
      assert('404 => not exists', d1.exists===false);
      assert('error text => not exists', d2.exists===false);
      assert('generic 200 => exists', d3.exists===true);
      const d4 = decideAvailabilityFromHTML(200, '<a href="/mebularts/followers/">', 'mebularts');
      assert('followers marker => exists', d4.exists===true);
      const d5 = decideAvailabilityFromHTML(200, 'Üzgünüz, bu sayfaya ulaşılamıyor.');
      assert('turkish not found => not exists', d5.exists===false);
      const maybePromise = safeCopy('test');
      assert('safeCopy returns Promise-like', !!maybePromise && typeof maybePromise.then==='function');
    }catch(e){
      const li=document.createElement('li'); li.textContent='Tests crashed: '+e.message; li.className='fail'; el('#testsList').appendChild(li);
    }
  })();
})();
</script>
</body>
</html>
