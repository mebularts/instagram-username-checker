<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Instagram Username Checker ‚Äî @mebularts</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' x2='1'%3E%3Cstop stop-color='%238b5cf6'/%3E%3Cstop offset='1' stop-color='%236ee7b7'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='64' height='64' rx='12' fill='url(%23g)'/%3E%3Ctext x='50%25' y='58%25' text-anchor='middle' font-size='34' fill='white'%3Ei%3C/text%3E%3C/svg%3E">
  <style>
    :root{
      --bg:#0b0f14; --fg:#eaf0f7; --muted:#9fb0c3; --card:#0f1622; --accent:#8b5cf6; --ok:#22c55e; --bad:#ef4444;
      --border:rgba(255,255,255,.12); --glass:rgba(15,22,34,.8);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; color:var(--fg);
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(139,92,246,.25), transparent),
        radial-gradient(1000px 700px at 110% 10%, rgba(34,197,94,.18), transparent),
        var(--bg);
    }
    .container{max-width:1120px; margin:0 auto; padding:24px}
    .row{display:grid; gap:16px}
    @media(min-width:900px){.row{grid-template-columns:1fr 1fr}}
    .card{background:var(--glass); border:1px solid var(--border); border-radius:16px; padding:16px; backdrop-filter: blur(6px); box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .btn{appearance:none; border:0; border-radius:12px; padding:10px 14px; font-weight:600; color:#fff; background:var(--accent); cursor:pointer}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .btn.ghost{background:transparent; border:1px solid var(--border); color:var(--fg)}
    .input, textarea{width:100%; background:#0d141c; border:1px solid var(--border); color:var(--fg); border-radius:12px; padding:12px; outline:none}
    .muted{color:var(--muted)}
    .header{display:flex; gap:12px; justify-content:space-between; align-items:flex-start; flex-wrap:wrap; margin-bottom:16px}
    .chip{padding:6px 10px; border:1px solid var(--border); border-radius:999px; color:var(--muted); font-size:13px}
    .results{display:grid; gap:12px}
    @media(min-width:720px){.results{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:1020px){.results{grid-template-columns:repeat(3,1fr)}}
    .pill{display:inline-block; padding:2px 8px; font-size:12px; border-radius:999px; border:1px solid var(--border)}
    .pill.ok{background:rgba(34,197,94,.12); color:#bcffe3; border-color:rgba(34,197,94,.35)}
    .pill.bad{background:rgba(239,68,68,.12); color:#ffd3d3; border-color:rgba(239,68,68,.35)}
    .row-inline{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .switch{position:relative; width:56px; height:30px; background:rgba(255,255,255,.12); border-radius:999px; border:1px solid var(--border); cursor:pointer}
    .switch .knob{position:absolute; inset:2px; background:#fff; width:26px; height:26px; border-radius:999px; transform:translateX(0); transition:transform .2s ease}
    .switch.on .knob{transform:translateX(26px)}
    .segment{display:inline-grid; grid-template-columns:1fr 1fr; gap:4px; padding:4px; border-radius:12px; background:rgba(255,255,255,.08); border:1px solid var(--border)}
    .segbtn{padding:6px 10px; border-radius:8px; border:0; background:transparent; color:var(--fg); cursor:pointer}
    .segbtn.active{background:var(--accent)}
    .tests{margin-top:16px; font-size:13px}
    .ok{color:#86efac}
    .fail{color:#fca5a5}
    .avatar{width:48px; height:48px; border-radius:999px; border:1px solid var(--border); object-fit:cover}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 style="margin:0; font-size:26px">Instagram Username Checker</h1>
        <div class="muted" id="subtitle">Kullanƒ±cƒ± adlarƒ± bo≈üta mƒ± dolu mu? Doluysa profil kartƒ±nƒ± g√∂sterir.</div>
      </div>
      <div class="row-inline">
        <div class="segment" role="group" aria-label="language">
          <button class="segbtn active" data-lang="tr">TR</button>
          <button class="segbtn" data-lang="en">EN</button>
        </div>
        <div id="themeSwitch" class="switch on" role="switch" aria-checked="true">
          <div class="knob"></div>
        </div>
        <a target="_blank" href="https://mebularts.com.tr"> <span id="modeChip" class="chip">üë®üèª‚Äçüíª by <strong>@mebularts</strong></span></a>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <label><b id="lblUsernames">Kullanƒ±cƒ± adlarƒ±</b></label>
          <textarea id="inputNames" rows="8" class="input" placeholder="mebularts\ninstagram\nbu_isim_bosta_olabilir"></textarea>
          <div class="row-inline" style="margin-top:10px">
            <button id="btnCheck" class="btn">Kontrol Et</button>
            <button id="btnSamples" class="btn ghost">√ñrnekleri Doldur</button>
            <label class="row-inline muted" style="margin-left:auto; gap:6px; font-size:14px">
              <input id="stopOnError" type="checkbox"/> Hata olursa dur
            </label>
            <span id="status" class="muted" style="font-size:14px"></span>
          </div>
        </div>
        <div>
          <label><b id="lblProxy">Proxy URL</b></label>
          <input id="proxy" class="input" placeholder="https://subdomain.workers.dev"/>
          <div id="proxyHint" class="muted" style="font-size:13px; margin-top:6px">Cloudflare Worker k√∂k adresinizi girin. √ñrn: https://subdomain.workers.dev</div>
          <details style="margin-top:8px">
            <summary id="workerCodeTitle" class="muted" style="cursor:pointer">Cloudflare Worker Kodu</summary>
<pre class="input" style="white-space:pre-wrap; overflow:auto; font-size:12px">export default {
  async fetch(req) {
    const url = new URL(req.url)
    const u = url.searchParams.get('u')
    if (!u) return new Response('missing u', { status: 400 })
    const h = new Headers({
      'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123 Safari/537.36',
      'accept': 'application/json, text/html;q=0.8,*/*;q=0.5',
      'accept-language': 'en-US,en;q=0.9,tr;q=0.8',
      'x-ig-app-id': '936619743392459',
      'sec-fetch-site': 'same-origin',
    })
    try {
      const r = await fetch(u, { redirect: 'follow', headers: h })
      const rh = new Headers(r.headers)
      rh.set('access-control-allow-origin', '*')
      rh.set('access-control-expose-headers', '*')
      return new Response(await r.arrayBuffer(), { status: r.status, headers: rh })
    } catch (e) {
      return new Response(String(e), { status: 502, headers: { 'access-control-allow-origin': '*' } })
    }
  }
}</pre>
          </details>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <div class="row-inline" style="justify-content:space-between">
        <div class="muted" id="lblResults">Sonu√ßlar</div>
        <div class="muted" id="lblCount"></div>
      </div>
      <div id="results" class="results" style="margin-top:12px"></div>
    </div>

    <div class="card" style="margin-top:16px">
      <div class="row-inline" style="justify-content:space-between; margin-bottom:10px">
        <div id="genTitle" style="font-weight:600">Varyasyon √úretici</div>
        <div class="muted" id="lblAmount">Adet</div>
      </div>
      <div class="row" style="grid-template-columns: 1fr 160px 1fr">
        <input id="base" class="input" placeholder="mebularts"/>
        <input id="amount" class="input" type="number" min="10" max="60" value="30"/>
        <div class="row-inline">
          <button id="btnGen" class="btn" style="flex:1">√úret</button>
          <button id="btnClear" class="btn ghost" style="flex:1">Temizle</button>
        </div>
      </div>
    </div>

    <div class="card tests" id="tests">
      <b>Tests</b>
      <ul id="testsList"></ul>
    </div>
  </div>

<script>
(function(){
  const t = {
    tr:{ title:'Instagram Username Checker', subtitle:'Kullanƒ±cƒ± adlarƒ± bo≈üta mƒ± dolu mu? Doluysa profil kartƒ±nƒ± g√∂sterir.', usernames:'Kullanƒ±cƒ± adlarƒ±', check:'Kontrol Et', samples:'√ñrnekleri Doldur', results:'Sonu√ßlar', unknown:'Bilinmiyor', error:'Hata/Kƒ±sƒ±t', useProxy:'Proxy kurup tekrar deneyin.', taken:'Kullanƒ±mda', available:'Bo≈üta', availableMsg:'Bu kullanƒ±cƒ± adƒ± kullanƒ±labilir.', copy:'kopyala', signup:"Instagram'a kaydol", needOne:'√ñnce en az bir kullanƒ±cƒ± adƒ± yazƒ±n.', proxyLbl:'Proxy URL', proxyHint:'Cloudflare Worker k√∂k adresinizi girin. √ñrn: https://subdomain.workers.dev', worker:'Cloudflare Worker Kodu', genTitle:'Varyasyon √úretici', baseLbl:'Temel isim', genBtn:'√úret', clear:'Temizle', amount:'Adet', checking:'Kontrol ediliyor...', done:'Bitti' },
    en:{ title:'Instagram Username Checker', subtitle:'Are usernames free or taken? If taken, shows a profile card.', usernames:'Usernames', check:'Check', samples:'Fill samples', results:'Results', unknown:'Unknown', error:'Error/Constraint', useProxy:'Set up the proxy and try again.', taken:'Taken', available:'Available', availableMsg:'This username is available.', copy:'copy', signup:'Sign up', needOne:'Enter at least one username first.', proxyLbl:'Proxy URL', proxyHint:'Enter your Cloudflare Worker root. Eg: https://subdomain.workers.dev', worker:'Cloudflare Worker Code', genTitle:'Variation Generator', baseLbl:'Base name', genBtn:'Generate', clear:'Clear', amount:'Count', checking:'Checking...', done:'Done' }
  }
  let lang = 'tr';
  let dark = true;

  const el = s=>document.querySelector(s);
  const els = s=>Array.from(document.querySelectorAll(s));

  function setLang(l){ lang=l; const L=t[lang];
    el('#subtitle').textContent = L.subtitle;
    el('#lblUsernames').textContent = L.usernames;
    el('#btnCheck').textContent = L.check;
    el('#btnSamples').textContent = L.samples;
    el('#lblResults').textContent = L.results;
    el('#lblProxy').textContent = L.proxyLbl;
    el('#proxyHint').textContent = L.proxyHint;
    el('#workerCodeTitle').textContent = L.worker;
    el('#genTitle').textContent = L.genTitle;
    el('#lblAmount').textContent = L.amount;
    el('#btnGen').textContent = L.genBtn;
    el('#btnClear').textContent = L.clear;
    els('.segbtn').forEach(b=>b.classList.toggle('active', b.dataset.lang===l));
  }
  function setTheme(on){ dark=on; document.body.style.background = dark
      ? 'radial-gradient(1200px 800px at 10% -10%, rgba(139,92,246,.25), transparent), radial-gradient(1000px 700px at 110% 10%, rgba(34,197,94,.18), transparent), var(--bg)'
      : '#f7fafc';
    document.body.style.color = dark? 'var(--fg)':'#0b1220';
    el('#themeSwitch').classList.toggle('on', dark);
  }

  function normalize(u){
    // Instagram: a-z 0-9 . _ , max 30, cannot start with dot, cannot end with dot, no consecutive dots
    u=(u||'').toLowerCase().replace(/[^a-z0-9._]/g,'');
    u=u.slice(0,30);
    u=u.replace(/\.{2,}/g,'.'); // collapse consecutive dots
    u=u.replace(/^\.+/,'');
    u=u.replace(/\.+$/,'');
    return u;
  }
  function genVariations(base,n){
    base=(base||'').trim().toLowerCase(); if(!base) return [];
    const core=normalize(base.replace(/\s+/g,''));
    const pfx=['get','hey','try','real','the','go','iam','its','mr','ms','team','club'];
    const sfx=['app','dev','lab','labs','studio','hq','pro','official','co','tr','ai','io','net'];
    const seps=['','_','.'];
    const nums=['','1','01','10','24','25','123','x','xx'];
    const turk=['resmi','ofis','yazilim','ajans'];
    const leet=v=>v.replace(/a/g,'4').replace(/e/g,'3').replace(/i/g,'1').replace(/o/g,'0').replace(/s/g,'5');
    const vowelless=core.replace(/[aeiou]/g,'');
    const out=new Set([core,leet(core),vowelless]);
    for(const p of pfx){ for(const s of seps){ for(const n1 of nums){ out.add(normalize(p+s+core+n1)); } } }
    for(const sx of sfx){ for(const s of seps){ for(const n1 of nums){ out.add(normalize(core+s+sx+n1)); } } }
    for(const w of turk){ for(const s of seps){ out.add(normalize(core+s+w)); } }
    return Array.from(out).filter(Boolean).slice(0, Number(n)||30);
  }
  function decideAvailabilityFromHTML(status,text,u=''){
    const lower=(text||'').toLowerCase();
    const notFoundSigs=[
      'page not found',
      "sorry, this page isn't available",
      '√ºzg√ºn√ºz, bu sayfaya ula≈üƒ±lamƒ±yor',
      'link you followed may be broken',
      'baƒülantƒ± bozuk olabilir',
    ];
    if(status===404 || notFoundSigs.some(sig=>lower.includes(sig))) return { exists:false };

    const existsSigs=[
      '/followers/', 'takip√ßi', 'following/', 'g√∂nderi', 'profili d√ºzenle',
      'aria-label="se√ßenekler"', 'role="img"', 'og:image', 'og:title', 'profile picture'
    ];
    if(existsSigs.some(sig=>lower.includes(sig))) return { exists:true };

    if(u){
      const uLower=(u||'').toLowerCase();
      if(lower.includes(`/${uLower}/followers/`)||lower.includes(`>${uLower}<`)||lower.includes(`content="https://www.instagram.com/${uLower}/"`)) return { exists:true };
    }

    return { exists:false };
  }

  function fetchViaProxy(proxy,url){
    return fetch(`${proxy}?u=${encodeURIComponent(url)}`, {redirect:'follow'})
      .then(r=>r.text().then(text=>({status:r.status, text})));
  }

  function checkOne(username, proxyRoot){
    const u = normalize(username);
    if(!u) return Promise.resolve({ username:u, error:'empty' });
    if(!proxyRoot) return Promise.resolve({ username:u, error:'proxy-required' });

    // 1) Primary: web_profile_info (most reliable and explicit null for available)
    return fetchViaProxy(proxyRoot, `https://www.instagram.com/api/v1/users/web_profile_info/?username=${u}`)
      .then(api=>{
        if(api.status===200 && api.text){
          try{
            const j = JSON.parse(api.text);
            if(j && j.data && Object.prototype.hasOwnProperty.call(j.data,'user')){
              if(j.data.user===null){
                return { username:u, exists:false, avatar:'', title:u, desc:'', method:'web_profile_info:null' };
              } else if(j.data.user){
                const usr=j.data.user;
                const avatar=(usr.hd_profile_pic_url_info&&usr.hd_profile_pic_url_info.url)||usr.profile_pic_url||'';
                const title=(usr.full_name||'')+' | '+u;
                const desc=usr.biography||'';
                return { username:u, exists:true, avatar, title, desc, method:'web_profile_info:user' };
              }
            }
          }catch(e){/* fallthrough */}
        }
        // 2) Secondary: topsearch exact match (gives exists=true if found exact username)
        return fetchViaProxy(proxyRoot, `https://www.instagram.com/api/v1/web/search/topsearch/?context=blended&query=${encodeURIComponent(u)}&count=10`)
          .then(sr=>{
            if(sr.status===200){
              try{
                const j = JSON.parse(sr.text);
                const arr = (j && j.users) ? j.users : [];
                const exact = arr.find(x=>x && x.user && (x.user.username||'').toLowerCase()===u);
                if(exact){
                  const user=exact.user; const avatar=user.profile_pic_url||''; const title=(user.full_name||'')+' | '+u; const desc='';
                  return { username:u, exists:true, avatar, title, desc, method:'topsearch:exact' };
                }
                return { username:u, exists:false, avatar:'', title:u, desc:'', method:'topsearch:none' };
              }catch(e){/* fallthrough */}
            }
            // 3) Fallback: HTML heuristics
            return fetchViaProxy(proxyRoot, `https://www.instagram.com/${u}/`).then(hr=>{
              const d = decideAvailabilityFromHTML(hr.status, hr.text, u);
              const ogImg = hr.text.match(/<meta[^>]+property=["']og:image["'][^>]+content=["']([^"']+)["'][^>]*>/i);
              const ogTitle = hr.text.match(/<meta[^>]+property=["']og:title["'][^>]+content=["']([^"']+)["'][^>]*>/i);
              const ogDesc = hr.text.match(/<meta[^>]+property=["']og:description["'][^>]+content=["']([^"']+)["'][^>]*>/i);
              const cdnImgMatch = hr.text.match(/<img[^>]+src=["']([^"']+cdninstagram[^"']+)["'][^>]*>/i);
              const avatar = ogImg? ogImg[1] : (cdnImgMatch? cdnImgMatch[1] : '');
              const title = ogTitle? ogTitle[1] : u;
              const desc = ogDesc? ogDesc[1] : '';
              return { username:u, exists:d.exists, avatar, title, desc, method:'html:'+hr.status };
            });
          });
      })
      .catch(e=>({ username:u, error:e.message||'network', method:'error' }));
  }

  // Clipboard in sandbox: only use async Clipboard API, no execCommand fallbacks
  function safeCopy(text){
    return new Promise((resolve)=>{
      try{
        if(navigator.clipboard && navigator.clipboard.writeText){
          navigator.clipboard.writeText(text).then(()=>resolve(true)).catch(()=>resolve(false));
          return;
        }
      }catch(e){}
      resolve(false);
    });
  }

  function renderResults(items){
    const L=t[lang];
    el('#lblCount').textContent = items.length? String(items.length) : '';
    const root = el('#results'); root.innerHTML='';
    for(const r of items){
      const card = document.createElement('div'); card.className='card';
      if(r.error){
        const msg = r.error==='proxy-required' ? (lang==='tr'?'Ger√ßek kontrol i√ßin √ºstte Proxy URL girin.':'Enter Proxy URL above for real checks.') : `${L.error}: ${r.error}`;
        card.innerHTML = `
          <div class="row-inline" style="justify-content:space-between">
            <div style="font-weight:700">@${r.username}</div>
            <span class="pill">${L.unknown}</span>
          </div>
          <div style="margin-top:6px; color:#ffd3d3">${msg}</div>
        `;
      } else if(r.exists){
        card.innerHTML = `
          <div class="row-inline" style="gap:10px; align-items:flex-start">
            <img class="avatar" referrerpolicy="no-referrer" src="${r.avatar||''}" onerror="this.style.visibility='hidden'" alt=""/>
            <div style="flex:1">
              <div class="row-inline" style="gap:8px; flex-wrap:wrap">
                <a href="https://www.instagram.com/${r.username}/" target="_blank" style="font-weight:700; color:inherit; text-decoration:underline">@${r.username}</a>
                <span class="pill bad">${L.taken}</span>
                ${r.method?`<span class="pill">${r.method}</span>`:''}
              </div>
              <div class="muted" style="font-size:14px; margin-top:4px">${(r.title||'').replace(/\| Instagram/g,'')}</div>
              <div class="muted" style="font-size:12px; margin-top:4px">${r.desc||''}</div>
            </div>
          </div>
        `;
      } else {
        card.innerHTML = `
          <div class="row-inline" style="justify-content:space-between">
            <div style="font-weight:700">@${r.username}</div>
            <span class="pill ok">${L.available}</span>
          </div>
          <div class="muted" style="margin-top:6px">${L.availableMsg}</div>
          <div class="row-inline" style="gap:8px; margin-top:8px; flex-wrap:wrap">
            <button class="btn ghost copy-btn" data-copy="@${r.username}">@${r.username} ${L.copy}</button>
            <a class="btn ghost" href="https://www.instagram.com/accounts/emailsignup/" target="_blank">${L.signup}</a>
            ${r.method?`<span class="pill">${r.method}</span>`:''}
          </div>
        `;
      }
      root.appendChild(card);
    }
  }

  function runCheck(){
    const L=t[lang];
    const names = el('#inputNames').value.split(/\r?\n/).map(s=>normalize(s.replace(/^@+/,''))).filter(Boolean);
    const list = Array.from(new Set(names)).slice(0,200);
    if(!list.length){ el('#status').textContent=L.needOne; return; }
    const proxyRoot = (el('#proxy').value||'').trim();
    el('#status').textContent=L.checking; renderResults([]); el('#modeChip').textContent = proxyRoot? 'üë®üèª‚Äçüíª by <strong>@mebularts</strong>' : 'üë®üèª‚Äçüíª by <strong>@mebularts</strong>';
    const out=[];

    (function process(i){
      if(i>=list.length){ el('#status').textContent=L.done; return; }
      checkOne(list[i], proxyRoot).then(item=>{
        out.push(item); renderResults(out);
        el('#status').textContent = `${i+1}/${list.length}`;
        if(item.error && el('#stopOnError').checked){ el('#status').textContent=L.done; return; }
        setTimeout(()=>process(i+1), 180);
      }).catch(e=>{
        out.push({ username:list[i], error:e.message }); renderResults(out);
        el('#status').textContent = `${i+1}/${list.length}`;
        if(el('#stopOnError').checked){ el('#status').textContent=L.done; return; }
        setTimeout(()=>process(i+1), 180);
      });
    })(0);
  }

  // UI bindings
  els('.segbtn').forEach(b=> b.addEventListener('click', ()=> setLang(b.dataset.lang)) );
  el('#themeSwitch').addEventListener('click', ()=> setTheme(!dark));
  el('#btnSamples').addEventListener('click', ()=>{
    el('#inputNames').value = lang==='tr' ? 'mebularts\ninstagram\nbu_isim_bosta_olabilir' : 'mebularts\ninstagram\nthis_may_be_free';
  });
  el('#btnCheck').addEventListener('click', runCheck);
  el('#btnGen').addEventListener('click', ()=>{
    const base = el('#base').value; const n = Number(el('#amount').value)||30;
    const vars = genVariations(base, n).join('\n');
    const cur = el('#inputNames').value.trim();
    el('#inputNames').value = cur ? (cur+'\n'+vars) : vars;
  });
  el('#btnClear').addEventListener('click', ()=>{ el('#inputNames').value=''; renderResults([]); el('#lblCount').textContent=''; });

  // Event delegation for copy buttons (clipboard‚Äësafe)
  document.addEventListener('click', (ev)=>{
    const btn=ev.target.closest('.copy-btn'); if(!btn) return;
    const txt=btn.getAttribute('data-copy')||''; const label=btn.textContent;
    safeCopy(txt).then((ok)=>{
      btn.textContent = ok ? (lang==='tr'?'Kopyalandƒ±':'Copied') : (lang==='tr'?'Kopya engellendi ‚Äî Ctrl+C':'Copy blocked ‚Äî Ctrl+C');
      setTimeout(()=>{ btn.textContent=label; }, 1400);
    });
  });

  // Defaults
  setLang('tr'); setTheme(true);

  // ---------- TESTS ----------
  function assert(name, cond){
    const li=document.createElement('li'); li.textContent=name+': '+(cond? 'OK' : 'FAIL'); li.className=cond? 'ok' : 'fail'; el('#testsList').appendChild(li);
  }
  (function runTests(){
    try{
      assert('normalize strips invalid', normalize('A!B?C')==='abc');
      assert('normalize keeps dot/underscore', normalize('a_b.c')==='a_b.c');
      const vars = genVariations('mebularts', 10);
      assert('variations length = 10', vars.length===10);
      assert('variations normalized', vars.every(v=>/^[-a-z0-9._]{1,30}$/.test(v)));
      const d1 = decideAvailabilityFromHTML(404, '');
      const d2 = decideAvailabilityFromHTML(200, "sorry, this page isn't available");
      const d3 = decideAvailabilityFromHTML(200, '<html><meta property="og:title" content="user"/></html>');
      assert('404 => not exists', d1.exists===false);
      assert('error text => not exists', d2.exists===false);
      assert('generic 200 => exists', d3.exists===true);
      const d4 = decideAvailabilityFromHTML(200, '<a href="/mebularts/followers/">', 'mebularts');
      assert('followers marker => exists', d4.exists===true);
      const d5 = decideAvailabilityFromHTML(200, '√úzg√ºn√ºz, bu sayfaya ula≈üƒ±lamƒ±yor.');
      assert('turkish not found => not exists', d5.exists===false);
      const maybePromise = safeCopy('test');
      assert('safeCopy returns Promise-like', !!maybePromise && typeof maybePromise.then==='function');
      // Extra tests
      assert('normalize length <= 30', normalize('a'.repeat(99)).length===30);
      const uniq = new Set(genVariations('mebularts', 30));
      assert('variations unique-ish', uniq.size===30);
    }catch(e){
      const li=document.createElement('li'); li.textContent='Tests crashed: '+e.message; li.className='fail'; el('#testsList').appendChild(li);
    }
  })();
})();
</script>
</body>
</html>
